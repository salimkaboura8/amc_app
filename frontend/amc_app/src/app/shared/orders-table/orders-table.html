<p-table
  [value]="orders"
  dataKey="id"
  [sortField]="sortField"
  [sortOrder]="sortOrder"
  [paginator]="showPaginator"
  [rows]="rows"
  [rowsPerPageOptions]="rowsPerPageOptions"
  [columns]="cols"
  class="orders-table"
>
  <ng-template pTemplate="header" let-columns>
    <tr>
      <th *ngFor="let col of columns" [pSortableColumn]="col.field">
        {{ col.header }}
      </th>
      <th>Infos</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-rowData let-columns="columns">
    <tr>
      <td *ngFor="let col of columns">
        <ng-container [ngSwitch]="col.field">
          <span *ngSwitchCase="'date'">
            {{ rowData[col.field] | date : 'dd/MM/y' }}
          </span>
          <span *ngSwitchCase="'price'"> {{ rowData[col.field] | number : '1.2-2' }} € </span>
          <p-tag
            *ngSwitchCase="'status'"
            [value]="statusLabel(rowData[col.field])"
            [severity]="statusSeverity(rowData[col.field])"
          ></p-tag>
          <span *ngSwitchDefault>
            {{ getFieldValue(rowData, col.field) }}
          </span>
        </ng-container>
      </td>
      <td class="actions">
        <button type="button" class="icon-btn" (click)="openDetails(rowData)">
          <i class="pi pi-info-circle" aria-hidden="true"></i>
        </button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage" let-columns="columns">
    <tr>
      <td [attr.colspan]="columns.length + 1">{{ emptyMessage }}</td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="detailsVisible"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '520px' }"
  header="Détails de la commande"
  (onHide)="closeDetails()"
>
  <div *ngIf="selectedOrder && selectedOrder.id && !isLoading" class="order-details">
    <div class="row" *ngFor="let col of cols">
      <span class="label">{{ col.header }}</span>
      <span class="value">
        <ng-container [ngSwitch]="col.field">
          <span *ngSwitchCase="'date'">
            {{ getFieldValue(selectedOrder, col.field) | date : 'dd/MM/y HH:mm' }}
          </span>
          <span *ngSwitchCase="'price'">
            {{ getFieldValue(selectedOrder, col.field) | number : '1.2-2' }} €
          </span>
          <p-tag
            *ngSwitchCase="'status'"
            [value]="statusLabel(getFieldValue(selectedOrder, col.field))"
            [severity]="statusSeverity(getFieldValue(selectedOrder, col.field))"
          ></p-tag>
          <span *ngSwitchDefault>
            {{ getFieldValue(selectedOrder, col.field) }}
          </span>
        </ng-container>
      </span>
    </div>

    <div class="row actions-row" *ngIf="isAdmin">
      <button
        pButton
        type="button"
        icon="pi pi-check"
        label="Accepter"
        class="btn-accept"
        (click)="accept(selectedOrder.id)"
        [disabled]="selectedOrder.status === OrderStatus.ACCEPTEE || isLoading"
      ></button>
      <button
        pButton
        type="button"
        icon="pi pi-times"
        label="Refuser"
        class="btn-refuse"
        severity="danger"
        (click)="refuse(selectedOrder.id)"
        [disabled]="selectedOrder.status === OrderStatus.REFUSEE || isLoading"
      ></button>
    </div>
  </div>

  <div class="order-details" *ngIf="isLoading">
    <p-progressSpinner styleClass="acting-spinner"></p-progressSpinner>
  </div>
</p-dialog>
